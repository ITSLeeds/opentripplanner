---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ITSleeds <a href='https://itsleeds.github.io/'><img src='man/figures/logo.png' align="right" height=215/></a>

[![Travis build status](https://travis-ci.org/ITSLeeds/opentripplanner.svg?branch=master)](https://travis-ci.org/ITSLeeds/opentripplanner) [![Coverage status](https://codecov.io/gh/ITSLeeds/opentripplanner/branch/master/graph/badge.svg)](https://codecov.io/github/ITSLeeds/opentripplanner?branch=master) [![Build status](https://ci.appveyor.com/api/projects/status/gqp3smc04as3qg85?svg=true)](https://ci.appveyor.com/project/layik/opentripplanner-05ana) [![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)


# OpenTripPlanner for R

The goal of OpenTripPlanner for R is to provide a simple R interface to [OpenTripPlanner (OTP)](https://www.opentripplanner.org/). The OTP is a multimodal trip planning service written in Java. For more information on what OTP is, see the [prerequisites vignette](https://itsleeds.github.io/opentripplanner/articles/prerequisites.html).

This package can be used to interface with a remote instance of OTP (e.g. a website) or help you set up and manage a local version of OTP for private use.  Basic setup and routing functions are outlined in the [getting started vignette](https://itsleeds.github.io/opentripplanner/articles/opentripplanner.html), while advanced functionality such as batch routing, isochrones, and customised setup is described in the [advanced features vignette](https://itsleeds.github.io/opentripplanner/articles/advanced_features.html).

## Installation

### OpenTripPlanner

To use OpenTripPlanner on your local computer you will need to install Java 8 and download the latest version of OTP. Instructions on installing Java and setting up OTP can be found in the [prerequisites vignette](https://itsleeds.github.io/opentripplanner/articles/prerequisites.html).

### R Package

Install the package using the **devtools** package as follows:

```{r install, eval=FALSE}
# If you do not already have the devtools package
install.packages("devtools")
# Install the package from GitHub
devtools::install_github("ITSleeds/opentripplanner")
# Load the package
library(opentripplanner)
```

## Usage

The package contains three groups of functions:

Functions for setting up a local instance of OTP:

1. `otp_dl_jar()`          To download the OTP Jar file
1. `otp_dl_demo()`         To download the demo data for the Isle of Wight
1. `otp_build_graph()`     To make a OTP graph from raw data
1. `otp_setup()`           To start up a local instance of OTP
1. `otp_make_config()`     To make a config object
1. `otp_validate_config()` To validate a config object
1. `otp_write_config()`    To save a config object as a json file

Functions for connecting to a local or remote instance of OTP:

1. `otp_connect()`      To connect to OTP

Functions for retrieving data from OTP:

1. `otp_plan()`         To get routes from A to B
1. `otp_isochrone()`     To get isochrone maps
1. `otp_geocode()`      To get the locations of named places e.g. road names

Results are returned as [sf objects](https://cran.r-project.org/web/packages/sf/index.html)

## Tests 

As this package does not work without a working connection to OTP, tests only run on machines that have the environment variable `I_have_OTP` with the value `TRUE`.
You can add this with `usethis::edit_r_environ()`.

```{r, eval=FALSE}
Sys.getenv("I_have_OTP")
```

## Acknowledgement

This package was built off the [tutorial by Marcus Young](https://github.com/marcusyoung/otp-tutorial).

## Contribution

Please note that the `opentripplanner` project is released with a [Contributor Code of Conduct](CODE_OF_CONDUCT.md). By contributing to this project, you agree to abide by its terms. Bug reports and comments are welcome as Github [Issues](https://github.com/ITSLeeds/opentripplanner/issues) and code submissions as [Pull Requests](https://github.com/ITSLeeds/opentripplanner/pulls).


## Package Status

This package is part of ongoing research at the University of Leeds, it is provided "as is" and is likely to be updated and changed without warning to meet the research needs of the University. It is our intention to bring a stable version to CRAN as soon as possible.
